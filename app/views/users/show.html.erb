

<div class="main_block">
  <div class="left_block">
    <div class="avatar">
      <img src="<%= @user.get_avatar %>" alt="">
    </div>
  </div>
  <div class="right_block">
    <div class="top_block">
      <div class="first_line">
          <span>
            <%= @user.name %> <%= @user.surname %>
          </span>
        <span class="online_status">
            <%= online_status @user %>
          </span>
      </div>
      <div class="user_info">
        <table>
          <tr>
            <td class="left_column">Дата регистрации :</td>
            <td class="right_column"><%= @user.created_at.strftime('%d/%m/%Y') %></td>
          </tr>
        </table>
      </div>
    </div>
    <!--  -->
    <div class="new_post">
      <% if can_current_user_change? @user.posts.new %>
        <%= form_with model: [@user, @user.posts.new], local: true, html: {class: 'pure-form'} do |form| %>
          <%= render 'posts/post_form', user: @user, form: form %>
        <% end %>
      <% end %>
    </div>
    <div class="posts">
      <% @user.posts.reverse.each do |post| %>
        <% next if post.id.nil? %>
        <div class="post">
          <div class="post_main_block">
            <div class="title"><%= post.title %></div>
            <div class="title_border"></div>
            <div class="body"><%= post.body %></div>
            <% if can_current_user_change? post %>
              <%= link_to '', edit_user_post_path(user_id: @user.id, id: post.id), class: 'edit_post_img' %>
              <%= link_to '', user_post_path(user_id: @user.id, id: post.id), method: "delete", class: 'delete_post_img' %>
            <% end %>
          </div>

          <div data-likeable-type="Post" data-likeable-id="<%= post.id %>">
            <%= render 'likes/like', type: post %>
          </div>

          <% if current_user %>
            <div class="add_comment">
              <%= form_for :comment, url: comments_path, html: {class: 'pure-form'} do |form| %>
                <div class="field">
                  <%= form.text_area :body, placeholder: 'Текст комментария...' %>
                  <%= form.hidden_field :commentable_type, value: 'Post' %>
                  <%= form.hidden_field :commentable_id, value: post.id %>
                  <%= form.file_field :image %>
                </div>
                <div class="actions">
                  <%= form.submit class: 'pure-button pure-button-primary' %>
                </div>
              <% end %>
            </div>
          <% end %>

          <% if post.images.any? %>
           <a class="btn btn-primary" data-toggle="collapse" href="#images<%#= post.id %>" role="button" aria-expanded="false" aria-controls="collapseExample">
             Images
           </a>
          <% end %>

<!--          <div class="collapse" id="images<%#= post.id %>">-->
<!--            <div class="row">-->
              <%# post.images.each do |image| %>
<!--                <div class="col-2"> <%#= image_tag image.url %> </div>-->
              <%# end %>
<!--            </div>-->
<!--          </div>-->


          <% if post.comments.any? %>
            <a class="btn btn-primary" data-toggle="collapse" href="#comments" role="button" aria-expanded="false" aria-controls="collapseExample">
              Other comments
            </a>
          <% end %>

          <div class="post_comments collapse" id="comments">
            <% post.comments.reverse.each do |comment| %>
              <%= render 'comments/comment', comment: comment %>
              <%= render 'comments/comment_new', comment: comment %>
              <%= render 'comments/comments', comment: comment %>
            <% end %>
          </div>


        </div>
      <% end %>
    </div>
  </div>
</div>
