<button id="test"></button>

<%= form_for :test, url: "/search", method: "get", remote: true do %>
  <%= label_tag(:q, "Search for:") %>
  <%= text_field_tag(:q) %>
  <%= submit_tag("Search") %>
<% end %>



<% unless flash[:success].nil? %>
  <div class="alert alert-success notice" role="alert">
    <%= flash[:success] %>
  </div>
<% end %>

<% unless flash[:error].nil? %>
  <div class="alert alert-danger notice" role="alert">
    <%= flash[:error] %>
  </div>
<% end %>

<div class="main_block">
  <div class="left_block">
    <div class="avatar">
      <img src="<%= @user.get_avatar %>" alt="">
    </div>
  </div>
  <div class="right_block">
    <div class="top_block">
      <div class="first_line">
          <span>
            <%= @user.name %> <%= @user.surname %>
          </span>
        <span class="online_status">
            <%= online_status @user %>
          </span>
      </div>
      <div class="user_info">
        <table>
          <tr>
            <td class="left_column">Дата регистрации :</td>
            <td class="right_column"><%= @user.created_at.strftime('%d/%m/%Y') %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="new_post">
      <% if can_current_user_change? @user.posts.new %>
        <%= form_with model: [@user, @user.posts.new], local: true, html: {class: 'pure-form'} do |form| %>
          <%= render 'posts/post_form', user: @user, form: form %>
        <% end %>
      <% end %>
    </div>
    <div class="posts">
      <% @user.posts.reverse.each do |post| %>
        <% next if post.id.nil? %>
        <div data-type="post>" data-id="<%= post.id %>" class="post">
          <div class="post_main_block">
            <div class="title"><%= post.title %></div>
            <div class="title_border"></div>
            <div class="body"><%= post.body %></div>
            <% if can_current_user_change? post %>
              <%= link_to '', edit_user_post_path(user_id: @user.id, id: post.id), class: 'edit_post_img' %>
              <%= link_to '', user_post_path(user_id: @user.id, id: post.id), method: "delete", class: 'delete_post_img' %>
            <% end %>
          </div>

          <div class="post_under_block">

            <div class="post_under_left_block">
              <% if current_user %>
                <a data-toggle="collapse" href="#post<%= post.id %>">
                  <%= fa_icon "plus-square" %>
                </a>
              <% end %>

              <% if post.images.any? %>
                <a data-toggle="collapse" href="#images<%= post.id %>" role="button" aria-expanded="false" aria-controls="collapseExample">
                  <%= fa_icon "image" %>
                </a>
              <% end %>

              <% if post.comments.any? %>
                <a data-toggle="collapse" href="#comments" role="button" aria-expanded="false" aria-controls="collapseExample">
                  <%= fa_icon "comments" %>
                </a>
              <% end %>
            </div>

            <div class="post_under_right_block">
              | <%= post.created_at.localtime.strftime("%H:%M:%S") %> |
              <div data-likeable-type="Post" data-likeable-id="<%= post.id %>">
                <%= render 'likes/like', type: post %>
              </div>
            </div>
          </div>


          <div class="add_comment collapse" id="post<%= post.id %>">
            <%= form_for :comment, url: comments_path, html: {class: 'pure-form'}, remote: true do |form| %>
              <div class="field">
                <%= form.text_area :body, placeholder: 'Текст комментария...' %>
                <%= form.hidden_field :commentable_type, value: 'Post' %>
                <%= form.hidden_field :commentable_id, value: post.id %>
                <%= form.file_field :image %>
              </div>
              <div class="actions">
                <%= form.submit class: 'pure-button pure-button-primary' %>
              </div>
              </div>
            <% end %>

            <div class="collapse" id="images<%= post.id %>">
              <div>
                <% post.images.each do |image| %>
                  <div data-toggle="modal" data-target="#postImage<%= image.id %>">
                    <%= image_tag image.data.url, class: 'full_width' %>
                    <% if can_current_user_change?(image.post)%>
                      <div><%= link_to "<i class='fa fa-times'></i>".html_safe, image_path(image), method: 'delete', class: 'img_del' %></div>
                    <% end %>
                  </div>

                  <div class="modal fade" id="postImage<%= image.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <%= image_tag image.data.url %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>


            <div data-id="<%= post.id %>" class="post_comments collapse" id="comments">
              <% post.comments.order('created_at DESC').each do |comment| %>
                <%= render 'comments/comment', comment: comment %>
                <%= render 'comments/comments', comment: comment %>
              <% end %>
            </div>


            </div>
      <% end %>
    </div>
  </div>
</div>


